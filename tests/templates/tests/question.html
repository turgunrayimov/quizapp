{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>{{ subject.name }} — Test {{ test_no }}</title>
    <link rel="stylesheet" href="{% static 'tests/css/styles.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div class="card">
    <h2>Savol {{ index }}/{{ total }}</h2>
    <h3>{{ question.text }}</h3>

    <form id="quiz-form" action="{% url 'submit' subject.id test_no %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="answer_id" id="answer_id">

        <div class="answers">
            {% for ans in answers %}
            <button
                type="button"
                class="answer-btn"
                data-id="{{ ans.id }}"
                data-correct="{{ ans.is_correct|yesno:'true,false' }}"
            >
                {{ forloop.counter }}. {{ ans.text }}
            </button>
            {% endfor %}
        </div>

        <button type="submit" id="next-btn" class="next-btn" disabled>
            Keyingi →
        </button>
    </form>
</div>

<script>
    const buttons = document.querySelectorAll(".answer-btn");
    const nextBtn = document.getElementById("next-btn");
    const answerInput = document.getElementById("answer_id");

    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            // agar allaqachon tanlangan bo‘lsa – qayta bosilmasin
            if (btn.classList.contains("selected")) return;

            const isCorrect = btn.dataset.correct === "true";
            answerInput.value = btn.dataset.id;

            // hamma variantlarni bloklash
            buttons.forEach(b => {
                b.classList.add("disabled");

                if (b.dataset.correct === "true") {
                    b.classList.add("correct-border");
                }
            });

            // tanlangan noto‘g‘ri bo‘lsa – qizil border
            if (!isCorrect) {
                btn.classList.add("wrong-border");
            }

            btn.classList.add("selected");
            nextBtn.disabled = false;
        });
    });
</script>

</body>
</html>